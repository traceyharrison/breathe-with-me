<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Breathe with Me - A calming breathing exercise app with visual guidance and customizable patterns">
    <title>Breathe with Me - Calm Your Mind</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <button class="settings-icon" onclick="toggleSettingsMenu()" aria-label="Settings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <span class="settings-label">Settings</span>
        </button>

        <button class="timer-icon" onclick="toggleTimerMenu()" aria-label="Session Timer">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12,6 12,12 16,14"></polyline>
            </svg>
            <span class="timer-label">Timer</span>
        </button>

        <div class="settings-menu" id="settingsMenu">
            <div class="settings-menu-header">
                <h3>Audio Settings</h3>
                <button class="close-btn" onclick="toggleSettingsMenu()">×</button>
            </div>
            <div class="settings-menu-content">
                <div class="toggle-group">
                    <label class="toggle-label">
                        <input type="checkbox" id="pingToggle" checked onchange="togglePing()">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">Transition Ping</span>
                    </label>
                </div>
                <div class="theme-selection" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.08);">
                    <label class="selection-label">Theme:</label>
                    <div class="theme-options">
                        <button class="theme-btn active" onclick="setTheme('night-sky')" data-theme="night-sky">
                            <span class="theme-preview night-sky-preview"></span>
                            Night Sky
                        </button>
                        <button class="theme-btn" onclick="setTheme('lofi')" data-theme="lofi">
                            <span class="theme-preview lofi-preview"></span>
                            LoFi
                        </button>
                        <button class="theme-btn" onclick="setTheme('sunset')" data-theme="sunset">
                            <span class="theme-preview sunset-preview"></span>
                            Forest
                        </button>
                    </div>
                </div>
                <div class="music-selection" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.08);">
                    <label class="selection-label">Background Music:</label>
                    <div class="music-controls">
                        <input type="checkbox" id="musicToggle" onchange="toggleMusic()" style="margin-right: 8px;">
                        <label for="musicToggle" style="font-size: 0.9em;">Enable Music</label>
                    </div>
                    <select id="musicSelect" onchange="changeMusic()" style="margin-top: 8px; width: 100%;">
                        <option value="unexplored-moon">Unexplored Moon - by Miguel Johnson</option>
                        <option value="dark-ambient">Dark Ambient - Forest Walk</option>
                        <option value="way-home">Way Home - by TokyoWalker4038</option>
                    </select>
                    <div class="music-volume" style="margin-top: 8px;">
                        <label style="font-size: 0.8em;">Volume:</label>
                        <input type="range" id="musicVolume" min="0" max="100" value="30" 
                               oninput="adjustVolume()" 
                               onchange="adjustVolumeWithTouch()"
                               ontouchend="adjustVolumeWithTouch()"
                               style="width: 100%; margin-top: 4px;">
                        <span id="volumeValue" style="font-size: 0.8em; opacity: 0.7;">30%</span>
                    </div>
                </div>
                
                <div class="music-selection" id="pingSelection" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.08);">
                    <label class="selection-label">Ping Notes Customization:</label>
                    <div class="ping-controls">
                        <div class="ping-phase-control">
                            <h5>Breathe In Phase</h5>
                            <div class="ping-adjustment">
                                <label>Frequency: <span id="breatheInFreqValue">110</span>Hz</label>
                                <input type="range" id="breatheInFreq" min="80" max="600" value="110" oninput="updatePingFrequency('low', 'breatheInFreq', 'breatheInFreqValue')">
                            </div>
                            <div class="ping-adjustment">
                                <label>Volume: <span id="breatheInVolValue">15</span>%</label>
                                <input type="range" id="breatheInVol" min="3" max="30" value="15" 
                                       oninput="updatePingVolume('low', 'breatheInVol', 'breatheInVolValue')"
                                       onchange="updatePingVolume('low', 'breatheInVol', 'breatheInVolValue')"
                                       ontouchend="updatePingVolume('low', 'breatheInVol', 'breatheInVolValue')">
                            </div>
                            <button class="test-ping-btn" onclick="testPing('low')">Test</button>
                        </div>
                        
                        <div class="ping-phase-control">
                            <h5>Hold Phase</h5>
                            <div class="ping-adjustment">
                                <label>Frequency: <span id="holdFreqValue">220</span>Hz</label>
                                <input type="range" id="holdFreq" min="80" max="600" value="220" oninput="updatePingFrequency('medium', 'holdFreq', 'holdFreqValue')">
                            </div>
                            <div class="ping-adjustment">
                                <label>Volume: <span id="holdVolValue">12</span>%</label>
                                <input type="range" id="holdVol" min="3" max="30" value="12" 
                                       oninput="updatePingVolume('medium', 'holdVol', 'holdVolValue')"
                                       onchange="updatePingVolume('medium', 'holdVol', 'holdVolValue')"
                                       ontouchend="updatePingVolume('medium', 'holdVol', 'holdVolValue')">
                            </div>
                            <button class="test-ping-btn" onclick="testPing('medium')">Test</button>
                        </div>
                        
                        <div class="ping-phase-control">
                            <h5>Breathe Out Phase</h5>
                            <div class="ping-adjustment">
                                <label>Frequency: <span id="breatheOutFreqValue">440</span>Hz</label>
                                <input type="range" id="breatheOutFreq" min="80" max="600" value="440" oninput="updatePingFrequency('high', 'breatheOutFreq', 'breatheOutFreqValue')">
                            </div>
                            <div class="ping-adjustment">
                                <label>Volume: <span id="breatheOutVolValue">8</span>%</label>
                                <input type="range" id="breatheOutVol" min="3" max="30" value="8" 
                                       oninput="updatePingVolume('high', 'breatheOutVol', 'breatheOutVolValue')"
                                       onchange="updatePingVolume('high', 'breatheOutVol', 'breatheOutVolValue')"
                                       ontouchend="updatePingVolume('high', 'breatheOutVol', 'breatheOutVolValue')">
                            </div>
                            <button class="test-ping-btn" onclick="testPing('high')">Test</button>
                        </div>
                        
                        <div class="ping-presets">
                            <label class="selection-label">Presets:</label>
                            <div class="preset-ping-buttons">
                                <button class="preset-ping-btn" onclick="setPingPreset('musical')">Musical (A2-A3-A4)</button>
                                <button class="preset-ping-btn" onclick="setPingPreset('gentle')">Gentle</button>
                                <button class="preset-ping-btn" onclick="setPingPreset('bright')">Bright</button>
                                <button class="preset-ping-btn" onclick="setPingPreset('custom')">Reset to Custom</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-management" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.08);">
                    <label class="selection-label">Settings Management:</label>
                    <div class="settings-actions">
                        <button class="settings-action-btn save-all" onclick="saveAllSettings()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                            </svg>
                            Save All Settings
                        </button>
                        <button class="settings-action-btn export" onclick="exportSettings()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Export Settings
                        </button>
                        <div class="import-settings">
                            <input type="file" id="settingsFileInput" accept=".json" style="display: none;" onchange="importSettings(event)">
                            <button class="settings-action-btn import" onclick="document.getElementById('settingsFileInput').click()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17,8 12,3 7,8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Import Settings
                            </button>
                        </div>
                        <button class="settings-action-btn reset" onclick="resetAllSettings()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="1,4 1,10 7,10"></polyline>
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                            </svg>
                            Reset to Defaults
                        </button>
                    </div>
                    <div class="settings-status" id="settingsStatus" style="margin-top: 8px; font-size: 0.8em; opacity: 0.7; text-align: center;">
                        Settings auto-save enabled
                    </div>
                </div>
            </div>
        </div>

        <div class="timer-menu" id="timerMenu">
            <div class="timer-menu-header">
                <h3>Session Timer</h3>
                <button class="close-btn" onclick="toggleTimerMenu()">×</button>
            </div>
            <div class="timer-menu-content">
                <div class="timer-status" id="timerStatus">No timer set</div>
                <div class="timer-display" id="timerDisplay" style="display: none;">00:00</div>
                
                <div class="timer-presets">
                    <h4>Quick Start</h4>
                    <div class="preset-timer-buttons">
                        <button class="timer-preset-btn" onclick="setTimerPreset(2)">2 min</button>
                        <button class="timer-preset-btn" onclick="setTimerPreset(5)">5 min</button>
                        <button class="timer-preset-btn" onclick="setTimerPreset(10)">10 min</button>
                    </div>
                </div>
                
                <div class="custom-timer">
                    <h4>Custom Duration</h4>
                    <div class="timer-input-group">
                        <label>Minutes: <span id="timerMinValue">5</span></label>
                        <input type="range" id="timerMinSlider" min="1" max="60" value="5" oninput="updateTimerDisplay()">
                    </div>
                    <button class="timer-set-btn" onclick="setCustomTimer()">Set Custom Timer</button>
                </div>
                
                <div class="timer-controls" id="timerControls" style="display: none;">
                    <button class="timer-start-btn" id="timerStartBtn" onclick="startTimer()">Start Timer</button>
                    <button class="timer-stop-btn" id="timerStopBtn" onclick="stopTimer()" style="display: none;">Stop Timer</button>
                </div>
            </div>
        </div>

        <h1>Breathe with Me</h1>
        <p class="subtitle">Breathing Exercises to Soothe Anxiety</p>
        
        <div class="settings" id="settings">
            <h3>Breathing Pattern</h3>
            <div class="preset-buttons">
                <button class="preset-btn active" onclick="setPreset('box')">Box (4-4-4-4)</button>
                <button class="preset-btn" onclick="setPreset('relaxing')">Relaxing (4-7-8)</button>
                <button class="preset-btn" onclick="setPreset('energizing')">Energizing (4-4-6)</button>
            </div>
            <div class="custom-button-row">
                <button class="preset-btn" onclick="setPreset('custom')">Custom</button>
            </div>
            
            <div class="custom-controls" id="customControls" style="display: none;">
                <div class="custom-controls-header">
                    <h4>Custom Pattern</h4>
                    <button class="close-btn" onclick="closeCustomControls()" title="Close dialog (pattern will remain active)">×</button>
                </div>
                <div class="slider-group">
                    <label>Breathe In: <span id="breatheInValue">4</span>s</label>
                    <input type="range" id="breatheInSlider" min="2" max="10" value="4" oninput="updateCustom()">
                </div>
                <div class="slider-group">
                    <label>Hold (After In): <span id="holdInValue">4</span>s</label>
                    <input type="range" id="holdInSlider" min="0" max="10" value="4" oninput="updateCustom()">
                </div>
                <div class="slider-group">
                    <label>Breathe Out: <span id="breatheOutValue">4</span>s</label>
                    <input type="range" id="breatheOutSlider" min="2" max="10" value="4" oninput="updateCustom()">
                </div>
                <div class="slider-group">
                    <label>Hold (After Out): <span id="holdOutValue">4</span>s</label>
                    <input type="range" id="holdOutSlider" min="0" max="10" value="4" oninput="updateCustom()">
                </div>
                <div class="custom-actions">
                    <div class="pattern-name-group">
                        <label for="patternName">Pattern Name:</label>
                        <input type="text" id="patternName" placeholder="My Custom Pattern" maxlength="30">
                    </div>
                    <button class="save-btn" onclick="saveCustomPattern()">Save Pattern</button>
                    <div class="saved-patterns" id="savedPatterns">
                        <h5>Saved Patterns:</h5>
                        <div class="saved-patterns-list" id="savedPatternsList">
                            <!-- Saved patterns will appear here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="start-btn" id="startBtn" onclick="startBreathing()">Start</button>
                <button class="stop-btn" id="stopBtn" onclick="stopBreathing()" disabled>Stop</button>
            </div>
            
            <div class="quick-music-control">
                <button class="music-toggle-btn" id="quickMusicToggle" onclick="quickToggleMusic()" title="Toggle background music">
                    <svg class="music-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18V5l12-2v13"></path>
                        <circle cx="6" cy="18" r="3"></circle>
                        <circle cx="18" cy="16" r="3"></circle>
                    </svg>
                    <svg class="music-off-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                        <path d="M2 2l20 20"></path>
                        <path d="M9 18V8l7-2v8"></path>
                        <circle cx="6" cy="18" r="3"></circle>
                        <circle cx="16" cy="16" r="3"></circle>
                    </svg>
                    <span class="music-status-text" id="musicStatusText">Music Off</span>
                </button>
            </div>
        </div>
        
        <div class="instruction" id="instruction">Press Start to Begin</div>
        <div class="counter" id="counter">4</div>
        
        <div class="breathing-box">
            <div class="box" id="breathingBox"></div>
        </div>
        
        <div class="session-timer-display" id="sessionTimerDisplay" style="display: none;">
            <div class="session-timer-text">Session Time Remaining</div>
            <div class="session-timer-countdown" id="sessionTimerCountdown">00:00</div>
        </div>
        
        <div class="info">
            <p>Choose from preset patterns or create your own custom breathing rhythm. Toggle the transition ping sound to customize your experience. Follow the visual cue and listen for the gentle ping to guide your breathing.</p>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
